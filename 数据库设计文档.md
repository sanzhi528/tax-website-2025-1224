# 财务税务代理公司网站 - 数据库设计文档

## 概述

本文档描述了财务税务代理公司网站的数据库设计方案。考虑到实际生产环境的需求，我们设计了完整的数据库模型，包括用户管理、服务管理、订单处理、咨询管理等核心功能。

## 数据库选择

推荐使用 **MySQL 8.0+** 或 **PostgreSQL 13+**，两者都支持：
- 事务处理
- 外键约束
- JSON数据类型
- 全文搜索
- 良好的性能优化

## 数据表设计

### 1. 用户表 (users)
存储网站注册用户信息

```sql
CREATE TABLE users (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    phone VARCHAR(20),
    company_name VARCHAR(200),
    is_vip BOOLEAN DEFAULT FALSE,
    vip_expiry_date DATE,
    registration_date TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    last_login TIMESTAMP,
    status ENUM('active', 'inactive', 'suspended') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_email (email),
    INDEX idx_phone (phone),
    INDEX idx_company (company_name),
    INDEX idx_vip (is_vip)
);
```

### 2. 管理员表 (admins)
存储后台管理员信息

```sql
CREATE TABLE admins (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    username VARCHAR(50) UNIQUE NOT NULL,
    email VARCHAR(100) UNIQUE NOT NULL,
    password_hash VARCHAR(255) NOT NULL,
    full_name VARCHAR(100) NOT NULL,
    role ENUM('super_admin', 'admin', 'editor') DEFAULT 'editor',
    permissions JSON, -- 存储权限配置
    last_login TIMESTAMP,
    status ENUM('active', 'inactive') DEFAULT 'active',
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_role (role),
    INDEX idx_status (status)
);
```

### 3. 服务类别表 (service_categories)
存储服务分类信息

```sql
CREATE TABLE service_categories (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    name VARCHAR(100) NOT NULL,
    description TEXT,
    icon VARCHAR(100), -- 图标类名或图片路径
    sort_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_active (is_active),
    INDEX idx_sort (sort_order)
);
```

### 4. 服务表 (services)
存储具体的服务项目

```sql
CREATE TABLE services (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    category_id BIGINT NOT NULL,
    name VARCHAR(200) NOT NULL,
    slug VARCHAR(200) UNIQUE NOT NULL, -- URL友好的标识
    description TEXT,
    detailed_description LONGTEXT,
    price_range VARCHAR(100), -- 价格范围，如 "2000-5000元"
    base_price DECIMAL(10,2), -- 基础价格
    features JSON, -- 服务特色，存储为JSON数组
    required_materials JSON, -- 所需材料清单
    processing_time VARCHAR(50), -- 处理时间
    is_featured BOOLEAN DEFAULT FALSE,
    is_active BOOLEAN DEFAULT TRUE,
    sort_order INT DEFAULT 0,
    meta_title VARCHAR(200),
    meta_description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (category_id) REFERENCES service_categories(id) ON DELETE RESTRICT,
    INDEX idx_category (category_id),
    INDEX idx_active (is_active),
    INDEX idx_featured (is_featured),
    INDEX idx_slug (slug)
);
```

### 5. 咨询表 (consultations)
存储客户提交的咨询信息

```sql
CREATE TABLE consultations (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    user_id BIGINT, -- 可为空，允许未登录用户咨询
    name VARCHAR(100) NOT NULL,
    phone VARCHAR(20) NOT NULL,
    email VARCHAR(100),
    company_name VARCHAR(200),
    service_id BIGINT NOT NULL,
    service_name VARCHAR(200), -- 冗余存储，避免服务删除后信息丢失
    description TEXT NOT NULL,
    budget_range VARCHAR(100),
    urgency ENUM('low', 'medium', 'high') DEFAULT 'medium',
    status ENUM('pending', 'processing', 'completed', 'cancelled') DEFAULT 'pending',
    assigned_admin_id BIGINT, -- 分配的处理管理员
    admin_notes TEXT, -- 管理员处理备注
    response_time INT, -- 响应时间（小时）
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE SET NULL,
    FOREIGN KEY (service_id) REFERENCES services(id) ON DELETE RESTRICT,
    FOREIGN KEY (assigned_admin_id) REFERENCES admins(id) ON DELETE SET NULL,
    INDEX idx_status (status),
    INDEX idx_urgency (urgency),
    INDEX idx_created (created_at),
    INDEX idx_user (user_id)
);
```

### 6. 订单表 (orders)
存储客户下单信息

```sql
CREATE TABLE orders (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    order_number VARCHAR(50) UNIQUE NOT NULL, -- 订单号，如 ORD202401200001
    user_id BIGINT NOT NULL,
    service_id BIGINT NOT NULL,
    service_name VARCHAR(200) NOT NULL,
    service_price DECIMAL(10,2) NOT NULL,
    quantity INT DEFAULT 1,
    total_amount DECIMAL(10,2) NOT NULL,
    customer_notes TEXT,
    status ENUM('pending', 'confirmed', 'processing', 'completed', 'cancelled') DEFAULT 'pending',
    payment_status ENUM('pending', 'paid', 'failed', 'refunded') DEFAULT 'pending',
    payment_method ENUM('alipay', 'wechat', 'bank_transfer', 'cash'),
    payment_date TIMESTAMP,
    assigned_admin_id BIGINT,
    completion_date TIMESTAMP,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (user_id) REFERENCES users(id) ON DELETE RESTRICT,
    FOREIGN KEY (service_id) REFERENCES services(id) ON DELETE RESTRICT,
    FOREIGN KEY (assigned_admin_id) REFERENCES admins(id) ON DELETE SET NULL,
    INDEX idx_order_number (order_number),
    INDEX idx_user (user_id),
    INDEX idx_status (status),
    INDEX idx_payment_status (payment_status),
    INDEX idx_created (created_at)
);
```

### 7. 文章表 (articles)
存储网站发布的文章和新闻

```sql
CREATE TABLE articles (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    title VARCHAR(200) NOT NULL,
    slug VARCHAR(200) UNIQUE NOT NULL,
    excerpt TEXT, -- 摘要
    content LONGTEXT NOT NULL,
    category ENUM('news', 'knowledge', 'policy', 'tips') DEFAULT 'news',
    author_id BIGINT NOT NULL,
    featured_image VARCHAR(500), -- 特色图片路径
    status ENUM('draft', 'published', 'archived') DEFAULT 'draft',
    published_at TIMESTAMP,
    view_count INT DEFAULT 0,
    meta_title VARCHAR(200),
    meta_description TEXT,
    tags JSON, -- 标签数组
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    FOREIGN KEY (author_id) REFERENCES admins(id) ON DELETE RESTRICT,
    INDEX idx_category (category),
    INDEX idx_status (status),
    INDEX idx_published (published_at),
    INDEX idx_slug (slug)
);
```

### 8. 常见问题表 (faqs)
存储常见问题及解答

```sql
CREATE TABLE faqs (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    question VARCHAR(500) NOT NULL,
    answer TEXT NOT NULL,
    category VARCHAR(100), -- 问题分类
    sort_order INT DEFAULT 0,
    is_active BOOLEAN DEFAULT TRUE,
    view_count INT DEFAULT 0,
    helpful_count INT DEFAULT 0, -- 有帮助计数
    not_helpful_count INT DEFAULT 0, -- 无帮助计数
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_category (category),
    INDEX idx_active (is_active),
    INDEX idx_sort (sort_order)
);
```

### 9. 系统设置表 (system_settings)
存储网站配置信息

```sql
CREATE TABLE system_settings (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    setting_key VARCHAR(100) UNIQUE NOT NULL,
    setting_value TEXT,
    setting_type ENUM('string', 'number', 'boolean', 'json') DEFAULT 'string',
    description TEXT,
    is_public BOOLEAN DEFAULT FALSE, -- 是否公开给前端
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    updated_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP ON UPDATE CURRENT_TIMESTAMP,
    INDEX idx_key (setting_key),
    INDEX idx_public (is_public)
);
```

### 10. 文件表 (files)
存储上传的文件信息

```sql
CREATE TABLE files (
    id BIGINT AUTO_INCREMENT PRIMARY KEY,
    filename VARCHAR(255) NOT NULL,
    original_name VARCHAR(255),
    file_path VARCHAR(500) NOT NULL,
    file_size BIGINT,
    mime_type VARCHAR(100),
    uploader_id BIGINT, -- 上传者ID
    uploader_type ENUM('user', 'admin') DEFAULT 'admin',
    is_public BOOLEAN DEFAULT TRUE,
    description TEXT,
    created_at TIMESTAMP DEFAULT CURRENT_TIMESTAMP,
    INDEX idx_uploader (uploader_id, uploader_type),
    INDEX idx_public (is_public),
    INDEX idx_created (created_at)
);
```

## 初始数据

### 服务类别初始数据
```sql
INSERT INTO service_categories (name, description, icon, sort_order) VALUES
('工商代理', '企业注册、变更、注销等工商事务', 'fa-building', 1),
('知识产权', '商标注册、版权登记、专利申请', 'fa-copyright', 2),
('会计服务', '税务申报、财务代理、审计服务', 'fa-calculator', 3),
('银行开户', '对公账户设立、金融服务', 'fa-university', 4);
```

### 服务项目初始数据
```sql
INSERT INTO services (category_id, name, slug, description, price_range, base_price) VALUES
(1, '公司注册', 'company-registration', '专业的企业工商代理服务', '2000-5000元', 3000.00),
(1, '公司变更', 'company-change', '公司信息变更服务', '1000-3000元', 1500.00),
(2, '商标注册', 'trademark-registration', '全面的知识产权服务', '1500-3000元', 2000.00),
(3, '会计代理', 'accounting-service', '专业的会计服务', '500-2000元/月', 800.00),
(4, '银行开户', 'bank-account-opening', '银行开户及金融服务', '1000-3000元', 1500.00);
```

### 系统设置初始数据
```sql
INSERT INTO system_settings (setting_key, setting_value, setting_type, description, is_public) VALUES
('site_name', '财务税务代理公司', 'string', '网站名称', TRUE),
('site_description', '专业财务税务代理服务，一站式企业服务解决方案', 'string', '网站描述', TRUE),
('contact_phone', '+86-0755-85216839', 'string', '联系电话', TRUE),
('contact_email', '1006993710@qq.com', 'string', '联系邮箱', TRUE),
('business_hours', '周一至周五 9:00-18:00', 'string', '营业时间', TRUE),
('maintenance_mode', 'false', 'boolean', '维护模式', FALSE);
```

## 索引优化建议

### 常用查询索引
```sql
-- 用户相关查询
CREATE INDEX idx_users_composite ON users(email, status);
CREATE INDEX idx_users_vip_date ON users(is_vip, registration_date);

-- 订单相关查询
CREATE INDEX idx_orders_composite ON orders(user_id, status, created_at);
CREATE INDEX idx_orders_date_range ON orders(created_at, payment_status);

-- 咨询相关查询
CREATE INDEX idx_consultations_composite ON consultations(status, urgency, created_at);
CREATE INDEX idx_consultations_admin ON consultations(assigned_admin_id, status);

-- 文章相关查询
CREATE INDEX idx_articles_composite ON articles(status, category, published_at);
CREATE INDEX idx_articles_search ON articles(title, excerpt);
```

### 全文搜索索引（MySQL）
```sql
-- 为文章标题和内容创建全文索引
ALTER TABLE articles ADD FULLTEXT(title, excerpt, content);

-- 为服务描述创建全文索引
ALTER TABLE services ADD FULLTEXT(name, description);

-- 为常见问题创建全文索引
ALTER TABLE faqs ADD FULLTEXT(question, answer);
```

## 安全考虑

### 数据加密
- 用户密码使用 bcrypt 或 Argon2 加密
- 敏感信息（如手机号）可考虑加密存储
- API密钥和令牌使用安全哈希

### 数据备份
- 定期自动备份数据库
- 备份文件加密存储
- 异地备份策略

### 访问控制
- 严格的数据库用户权限管理
- 使用预编译语句防止SQL注入
- 输入数据验证和清理

## 性能优化

### 查询优化
- 避免 SELECT *，只选择需要的字段
- 合理使用索引，避免全表扫描
- 使用分页查询大数据集

### 缓存策略
- 使用Redis缓存热点数据
- 查询结果缓存
- 页面静态化

### 数据库配置
- 合理的连接池配置
- 定期优化表结构
- 监控慢查询日志

## 扩展性考虑

### 分库分表
当数据量增长时，可以考虑：
- 按业务模块分库
- 按时间范围分表（如按年分表）
- 用户数据分片

### 读写分离
- 主数据库处理写操作
- 从数据库处理读操作
- 使用数据库中间件

这个数据库设计为财务税务代理公司网站提供了完整的数据存储解决方案，支持现有的所有功能，并考虑了未来的扩展需求。